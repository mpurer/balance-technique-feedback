<script src="https://cdn.jsdelivr.net/npm/@mediapipe/pose@0.5/pose.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"></script>

<script>

const videoElement = document.getElementById('video');
const canvasElement = document.getElementById('canvas');
const canvasCtx = canvasElement.getContext('2d');

const pose = new Pose.Pose({
  locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/pose@0.5/${file}`
});

pose.setOptions({
  modelComplexity: 1,
  smoothLandmarks: true,
  minDetectionConfidence: 0.5,
  minTrackingConfidence: 0.5
});

pose.onResults(onResults);

function onResults(results) {
  canvasCtx.save();
  canvasCtx.clearRect(0, 0, canvasElement.width, canvasElement.height);
  canvasCtx.drawImage(results.image, 0, 0, canvasElement.width, canvasElement.height);

  if (results.poseLandmarks) {
    drawConnectors(canvasCtx, results.poseLandmarks, Pose.POSE_CONNECTIONS);
    drawLandmarks(canvasCtx, results.poseLandmarks);

    // Arm detection
    const lW = results.poseLandmarks[15];
    const rW = results.poseLandmarks[16];
    const lS = results.poseLandmarks[11];
    const rS = results.poseLandmarks[12];

    const left = lW.y < lS.y ? "LEFT ARM: ABOVE" : "LEFT ARM: BELOW";
    const right = rW.y < rS.y ? "RIGHT ARM: ABOVE" : "RIGHT ARM: BELOW";

    canvasCtx.font = "30px Arial";
    canvasCtx.fillStyle = "yellow";
    canvasCtx.fillText(left, 10, 40);
    canvasCtx.fillText(right, 10, 80);
  }

  canvasCtx.restore();
}

navigator.mediaDevices
  .getUserMedia({ video: { facingMode: "user" } })
  .then(stream => {
    videoElement.srcObject = stream;
    videoElement.onloadeddata = () => {
      canvasElement.width = videoElement.videoWidth;
      canvasElement.height = videoElement.videoHeight;

      const camera = new CameraUtils.Camera(videoElement, {
        onFrame: async () => { await pose.send({ image: videoElement }); },
        width: videoElement.videoWidth,
        height: videoElement.videoHeight
      });
      camera.start();
    };
  });

</script>
